/*
 * dialog.js
 * 2016-11-14
 * Sheng Jiang
 * 1.0.0.0
 */
(function(window,$,nova){"use strict";if(nova.dialog){return false;}
var $document=$(document);var $body=$("body");var count=0;var timeStamp=+(new Date());var template=''+'<div class="nova-dialog">'+'    <div class="nova-dialog-close"><i></i></div>'+'    <div class="nova-dialog-header"></div>'+'    <div class="nova-dialog-body"></div>'+'    <div class="nova-dialog-footer"></div>'+'</div>';function Factory(options){options=$.extend({},Factory.defaults,options);var dialogId=timeStamp+count;count++;var dialog=new Dialog(options,dialogId);dialog.id=dialogId;Dialog.list[dialogId]=dialog;return dialog;}
Factory.defaults={template:template,cloneEvent:true,showClose:true,buttons:null,fixed:true,masked:true,draggable:false,topFixed:false,topOffset:60,initHeight:"300px",initCallback:null,beforeClosingCallback:null,okCallback:null,cancelCallback:null,okText:"确定",cancelText:"取消",okClassName:"btn-orange",cancelClassName:"",content:"",contentClone:true,title:"消息提醒",time:null,width:"",height:"",wrapClass:"",maskClass:"nova-overlay",zIndex:1};function Dialog(options,dialogId){this.init(options,dialogId);}
Dialog.list={};$(window).on("resize",function(){for(var id in Dialog.list){var dialog=Dialog.list[id];dialog.resize();}});Dialog.prototype={version:"1.0.0.0",construction:Dialog,init:function(options,dialogId){this.options=options;this.defaults=Factory.defaults;var self=this;self.setButton(options);var template=this.options.template;self.wrap=$(template);self.wrap.attr("data-id",dialogId);var wrap=self.wrap;wrap.addClass(options.wrapClass);self.buttons();self.size(options.width,options.height);self.title(options.title);self.content(options.content);if(options.zIndex===null){options.zIndex="auto";}
self.zIndex(options.zIndex);self.time(options.time);if(options.masked===true){setTimeout(function(){self.mask(options);},0);}
self.bindEvent(options);if(options.draggable===true){self.drag();}
self.showClose(options.showClose);self.wrap.hide();$body.append(self.wrap);setTimeout(function(){self.resize();self.wrap.show();if(typeof options.initCallback==="function"){options.initCallback.call(self);}},0);},loading:function(){this.content('<div class="nova-dialog-body-loading"><i></i><br>正在加载中...</div>');},showClose:function(showClose){if(showClose){this.wrap.find(".nova-dialog-close").show();}else{this.wrap.find(".nova-dialog-close").hide();}},drag:function(){var wrap=this.wrap;var dialogTop;var dialogLeft;var $header=wrap.find(".nova-dialog-header");var pageX;var pageY;$header.on("mousedown",function(e){wrap.addClass("nova-dialog-moving");pageX=e.pageX;pageY=e.pageY;$body.on("mousemove",mouseMoveHandler);});function mouseMoveHandler(e){var pageXNext=e.pageX;var pageYNext=e.pageY;var x=pageXNext-pageX;var y=pageYNext-pageY;pageX=pageXNext;pageY=pageYNext;dialogTop=parseInt(wrap.css("top"));dialogLeft=parseInt(wrap.css("left"));wrap.css({top:dialogTop+y,left:dialogLeft+x});}
$document.on("mouseup",function(e){$body.off("mousemove",mouseMoveHandler);wrap.removeClass("nova-dialog-moving");});},time:function(time){var self=this;var timer=this.timer;if(timer){clearTimeout(timer);}
if(time){this.timer=setTimeout(function(){self.close();},time);}},zIndex:function(index){this.wrap.css("zIndex",index);},setButton:function(){var options=this.options;if(options.buttons&&options.buttons.push){}else{options.buttons=[];}
if(options.okCallback){var okButton={className:options.okClassName,text:options.okText,callback:options.okCallback};options.buttons.push(okButton)}
if(options.cancelCallback){var cancelButton={className:options.cancelClassName,text:options.cancelText,callback:options.cancelCallback};options.buttons.push(cancelButton)}},buttons:function(){var buttons=this.options.buttons;var size=buttons.length;var className;var $footer=this.wrap.find(".nova-dialog-footer");if(size==0){$footer.hide();}
for(var i=0;i<size;i++){var button=buttons[i];var $button=$("<span class='btn'></span>");if($.isArray(button.className)){for(var j=0;j<button.className.length;j++){className+=button.className[j]+" ";}}else{if(button.className===undefined){className=""}else{className=button.className}}
$button.attr({"class":"btn "+className}).html(button.text);$footer.append($button);}},bindEvent:function(){var self=this;self.wrap.on("click",".nova-dialog-close",{self:self},self.closeDialogHandler);self.wrap.on("click",".nova-dialog-footer>*",{self:self},self.buttonHandler)},buttonHandler:function(e){var self=e.data.self;var $this=$(this);var index=$this.index();var button=self.options.buttons[index];var callback=button.callback;if(callback&&$.isFunction(callback)){var ret=callback.call(self);if(ret===false){}else{self.close();}}else{self.close();}},closeDialogHandler:function(e){var self=e.data.self;self.close();},close:function(force){var contentClone=this.options.contentClone;var beforeunload=this.options.beforeClosingCallback;if(!force&&beforeunload&&$.isFunction(beforeunload)){var ret=beforeunload.call(this);if(ret===false){return;}}
if(!contentClone){if(this._elemBack){this._elemBack();}}
this.wrap.remove();this.mask();delete Dialog.list[this.id];},title:function(title){var $header=this.wrap.find(".nova-dialog-header");if(title===null){$header.hide();this.wrap.addClass("nova-dialog-no-title");}else{$header.html(title);}},content:function($content){var self=this;if(this._elemBack){this._elemBack();}
var $body=this.wrap.find(".nova-dialog-body");var contentClone=this.options.contentClone;if(this.options.url){this.wrap.addClass("nova-dialog-custom");var $iframe=$('<iframe src="'+$content+'" frameborder="0"></iframe>');$body.html($iframe);var dialogHeight=this.wrap.height();var $header=this.wrap.find(".nova-dialog-header:visible");var $footer=this.wrap.find(".nova-dialog-footer:visible");var headerHeight=$header.outerHeight(true);var footerHeight=$footer.outerHeight(true);var bodyHeight=dialogHeight-(headerHeight?headerHeight:0)-(footerHeight?footerHeight:0);var initialHeight=this.options.initHeight;if(initialHeight){$body.height(parseInt(initialHeight))}else{$body.height(bodyHeight);}
return;}
if(typeof $content==="string"){$body.html($content);}else if($($content).get(0)&&$($content).get(0).nodeType===1){if(contentClone){var cloneEvent=this.options.cloneEvent;var contentCloned=$content.clone(cloneEvent);contentCloned.show();$body.html(contentCloned);}else{var content=$($content).get(0);var display=content.style.display;var prev=content.previousSibling;var next=content.nextSibling;var parent=content.parentNode;this._elemBack=function(){if(prev&&prev.parentNode){prev.parentNode.insertBefore(content,prev.nextSibling);}else if(next&&next.parentNode){next.parentNode.insertBefore(content,next);}else if(parent){parent.appendChild(content);}
content.style.display=display;self._elemBack=null;};$body.html($content);$content.show();}}},size:function(width,height){if(typeof width==="number"){width+="px";}
if(typeof height==="number"){height+="px";}
this.wrap.css({width:width,height:height});},resize:function(){var $window=$(window);var windowHeight=$window.height();var windowWidth=$window.width();var dialogWidth=this.wrap.width();var dialogHeight=this.wrap.height();var left=~~((windowWidth-dialogWidth)/2);if(this.options.topFixed){var dialogAutoTop=$window.scrollTop()+this.options.topOffset;this.wrap.css({position:"absolute",top:dialogAutoTop,left:left});return;}
if(windowHeight-dialogHeight>=0){this.offsets();}else{var dialogTop=$window.scrollTop()+10;this.wrap.css({position:"absolute",top:dialogTop,left:left})}},offsets:function(){var windowWidth=$(window).width();var windowHeight=$(window).height();var dialogWidth=this.wrap.width();var dialogHeight=this.wrap.height();var left=~~((windowWidth-dialogWidth)/2);var top=~~((windowHeight-dialogHeight)/2);this.wrap.css({position:"fixed",top:top,left:left})},mask:function(){var mask=this.options.masked;if(mask){this.wrap.attr("data-mask","mask");}
var $mask;$mask=$(".nova-overlay");if($mask.length==0){$mask=$('<div class="nova-overlay"></div>');$body.append($mask);}
$mask.css("zIndex",this.options.zIndex);var $dialogs=$(".nova-dialog[data-mask=mask]");$mask.attr("class","nova-overlay");if($dialogs.length==0){$mask.hide();}else{$mask.show();var $dialog=$dialogs.last();var dialogId=$dialog.attr("data-id");var dialog=Dialog.list[dialogId];$dialog.before($mask);var maskClass=dialog.options.maskClass;$mask.addClass(maskClass);$mask.css("zIndex",dialog.options.zIndex);}}};nova.dialog=Factory;window.nova=nova;nova.alert=function(content,callback){return Factory({fixed:true,masked:true,content:content,okCallback:true,beforeClosingCallback:callback});};nova.confirm=function(content,okCallback,cancel){return Factory({fixed:true,lock:true,content:content,okCallback:okCallback?okCallback:true,cancelCallback:cancel?cancel:true});};nova.msg=function(content,time){return Factory({showClose:false,title:null,fixed:true,masked:false,content:content,time:time?time:2000});};nova.loading=function(content,callback){var html='<div class="nova-dialog-body-loading"><i></i></div>';return Factory({showClose:false,title:null,content:content?content:html,beforeClosingCallback:callback})};for(var c in Dialog){if(Dialog.hasOwnProperty(c)){if(typeof Dialog[c]==="function"){Factory[c]=Dialog[c]}}}})(window,jQuery,window.nova||{});
;$(function(){$(document).on("click",".ppi-more a",function(){var $promotion=$("#product-promotion");$promotion.toggleClass("pp-preferential-info-open");});$('.crumbs-list').hover(function(){$(this).addClass('crumbs-down');},function(){$(this).removeClass('crumbs-down')});$('.js_top_img_scroll').imgScroll1({migBox:'.img_scroll_box',tabBox:'.img_scroll_tab',btnL:'.img_scroll_l',btnR:'.img_scroll_r',tab_name:'active',runStyle:1});var ui=nova.ui();ui.render();$(".js_tip,.detail_product_tit .tagsback").poptip({place:6});$(".js_tip12").poptip({place:12});$('.js_tips_two').poptip({offsetX:-18});$(document).on('click','.booking_list_table .js-display-info',function(){var $this=$(this),$info=$this.parent().siblings('.room_info'),display=$info.css('display');if($.browser.msie)
{var version=$.browser.version;}
if(display=="block")
{if(version=="7.0"){$info.hide();}
else
{$info.slideUp();}
$this.find('i').removeClass('view-icon-up');}
else
{if(version=="7.0"){$info.show();}
else
{$info.slideDown();}
$this.find('i').addClass('view-icon-up');}});$('.js_btn_other').live('click',function(){var dataText=$(this).attr('data-word');if(dataText)
{var upText='收起'+dataText,downText='展开'+dataText;}
else
{var upText='收起',downText='展开';}
if(!$(this).hasClass('other_show')){$(this).addClass('other_show').html(upText+'<i class="view-icon view-icon-up"></i>').siblings('.room_list').show();}else{$(this).removeClass('other_show').html(downText+'<i class="view-icon view-icon-arrow"></i>').siblings('.room_list:gt(3)').hide();};});$(document).on('click','.js_checkbox',function(e){var $this=$(this);if($this.hasClass('checkbox_ok')){$this.removeClass('checkbox_ok');}else{$this.addClass('checkbox_ok');}});function bookingScroll(){var $booking_float=$('#booking_float'),float_t=$booking_float.offset().top,booking_all_t=$('.booking_all').offset().top,winH=$(window).height(),winT=$(document).scrollTop();if(winT+winH>booking_all_t+$('.booking_all').outerHeight()){$booking_float.addClass('float_absolute').show();}else if(winT+winH>booking_all_t+75){$booking_float.removeClass('float_absolute').show();}else{$booking_float.removeClass('float_absolute').hide();};}
bookingScroll();$(window).scroll(function(event){bookingScroll();});var tit_timer=null;window.titleHover=function(self,showId){var L=self.offset().left,T=self.offset().top,H=self.height();clearTimeout(tit_timer);showId.show().css({'left':L,'top':T+H+5});};$(document).on('mouseover','.title_float_box',function(e){clearTimeout(tit_timer);});$(document).on('mouseout','.table_list_name,.title_float_box',function(e){tit_timer=setTimeout(function(){$('.title_float_box').hide();},300);});$(document).on('click','.cgDetail_tab li',function(e){var num=$(this).index();$(this).addClass('active').siblings().removeClass('active');$(this).parent().siblings('.cgDetail_list').eq(num).show().siblings('.cgDetail_list').hide();});var $jsScroll=$('.js_cgDetail_scroll');$(document).on('click','.img_type_tab a',function(e){var num=$(this).index();$(this).addClass('active').siblings().removeClass('active');$jsScroll.eq(num).show().siblings('.js_cgDetail_scroll').hide();});$('.js_cgDetail_scroll').each(function(){$(this).imgScroll1({migBox:'.img_scroll_box',tabBox:'.img_scroll_tab',btnL:'.img_scroll_l',btnR:'.img_scroll_r',tab_name:'active',runStyle:1});})
$('.J_scrollnav').scrollNav({thisName:'active',triggerNum:0,difference:40,trigger:[function(){$('.tab-dest').addClass('css3_b');$('.nchline-just-buy').show();},function(){$('.tab-dest').removeClass('css3_b');$('.nchline-just-buy').hide();}]});$('.instance_tab li').click(function(){var num=$(this).index(),L=$(this).offset().left,pL=$(this).parent().offset().left,W=$(this).outerWidth(),jtL=L-pL+W/2-10;$(this).addClass('active').siblings().removeClass('active');$('.instance_list li').eq(num).show().siblings().hide();$('.instance_list2_box').each(function(){$(this).find('.instance_list2').eq(num).show().siblings().hide();});$('.instance_jt').css('left',jtL);});var instance_length=$('.instance_tab li').length;if(instance_length<1&&$('#J_scrollNav1').length==1){instance_length=1;}
for(var i=1;i<=instance_length;i++){$('#J_scrollNav'+i).scrollNav({thisName:'active',difference:84});}
$('.js-trip-days').each(function(){var $this=$(this),$span=$this.find('span');$span.on('click',function(){var $This=$(this);$This.addClass('active').siblings().removeClass('active');});});$('.js_package_choose').live('click',function(){$(this).parents('.change_list').addClass('change_active').siblings('.change_list').removeClass('change_active')});})
function myAlert(elem){this.o=elem;};myAlert.prototype={opcity:$('.opacityBox'),init:function(){var self=this;this.o.on('click','.detailIcon-close',function(){self.close();});this.initOther&&this.initOther()},hasAlert:function(){var isHide=true;for(var i=0;i<$('.changeBox').length;i++){if(!$('.changeBox').eq(i).is(':hidden')){isHide=false;};};if(isHide){return false;}else{return true;};},open:function(){var self=this;if(this.hasAlert()){this.opcity.css('z-index',100);this.o.css('z-index',100);};this.o.show();this.myResize();this.opcity.show();$('body').css('overflow','hidden');},close:function(){this.o.hide();if(!this.hasAlert()){this.opcity.hide();};this.opcity.css('z-index',99);this.o.css('z-index',99);$('body').css('overflow','auto');},myResize:function(){winH=$(window).height();if(this.o.hasClass('cgHotel')){if(winH<768){this.o.css({'height':winH-103,'marginTop':-(winH-46)/2});this.cgHotelScroll.css({'height':winH-170});}}else if(this.o.hasClass('cgTicket')){if(winH<768){this.o.css({'height':winH-103,'marginTop':-(winH-46)/2});this.cgHotelScroll.css({'height':winH-170});}}}};var changeHotel=new myAlert($('.cgHotel'));changeHotel.initOther=function(){this.cgHotelScroll=this.o.find('.cgHotel-scroll');};changeHotel.init();var changeTicket=new myAlert($('.cgTicket'));changeTicket.initOther=function(){this.cgHotelScroll=this.o.find('.cgTicket-scroll');};changeTicket.init();var changecgHotelDetail=new myAlert($('.cgHotelDetail'));changecgHotelDetail.initOther=function(){this.cgHotelScroll=this.o.find('.cgHotel-scroll');};changecgHotelDetail.init();var changecgTicketDetail=new myAlert($('.cgTicketDetail'));changecgTicketDetail.initOther=function(){this.cgHotelScroll=this.o.find('.cgHotel-scroll');};changecgTicketDetail.init();(function($){$.scrollNav={init:function(data){this.fangfa(data);},fangfa:function(data){var This=data.obj;var that=this;var Li=$(This).find('li');var Liname=data.thisName;var run=data.runName;var arrT=[];var ie6=!-[1,]&&!window.XMLHttpRequest;var timer=null;if(!ie6){for(var i=0;i<Li.length;i++){var thisId=Li.eq(i).attr('date_id');if($('#'+thisId).length==1){var T=$('#'+thisId).offset().top-data.difference;}else{var T=9999999;}
arrT.push(T);}
$(window).scroll(function(){clearTimeout(timer);timer=setTimeout(function(){scrollNow();},10)});function scrollNow(){var _scrollTop=$(document).scrollTop();var lastH=$('#'+Li.last().attr('date_id')).height();arrT=[];for(var i=0;i<Li.length;i++){var thisId=Li.eq(i).attr('date_id');if($('#'+thisId).length==1){var T=$('#'+thisId).offset().top-data.difference;}else{var T=9999999;}
arrT.push(T);}
for(var j=0;j<arrT.length;j++){var _top=arrT[j];if(_scrollTop>=_top){if(_scrollTop>=arrT[arrT.length-1]+lastH){Li.removeClass(Liname);}else{Li.eq(j).addClass(Liname).siblings().removeClass(Liname);}}};var runSr=run.parent().offset().top;if(_scrollTop>runSr-data.difference&&_scrollTop<runSr+run.parent().parent().height()-$(This).height()-data.difference&&run.parent().width()<200){$(This).parent().css({'position':'fixed','top':60,'z-index':100,'width':100});}else if(_scrollTop>runSr&&run.parent().width()>200){$(This).parent().css({'position':'fixed','top':0,'z-index':100,'width':run.parent().width()});$(This).parent().addClass('tab-fixed-now');}else if(_scrollTop<run.parent().offset().top){Li.eq(0).addClass(Liname).siblings().removeClass(Liname);run.attr({'style':''});$(This).parent().removeClass('tab-fixed-now');}else{run.attr({'style':''});$(This).parent().removeClass('tab-fixed-now');};if(data.maxTrigger==false){if(_scrollTop>=arrT[arrT.length-1]+lastH){if(data.trigger.length>1){data.trigger[0]();}else{data.trigger();}}else{if(data.trigger.length>1){data.trigger[1]();}}}else{if(_scrollTop>=arrT[data.triggerNum]){if(data.trigger.length>1){data.trigger[0]();}else{data.trigger();}}else{if(data.trigger.length>1){data.trigger[1]();}}}};scrollNow();Li.click(function(){var navThis=this,index=$(this).index();arrT=[];for(var i=0;i<Li.length;i++){var thisId=Li.eq(i).attr('date_id');if($('#'+thisId).length==1){var T=$('#'+thisId).offset().top-data.difference;}else{var T=9999999;}
arrT.push(T);}
$('body,html').animate({'scrollTop':arrT[index]+1},data.runTime,function(){setTimeout(function(){$(navThis).addClass(Liname).siblings().removeClass(Liname);},50)});})};},trigger:function(){}};$.fn.scrollNav=function(options){var data={obj:this,thisName:'active',runName:$(this).parent(),difference:$(this).parent().outerHeight(),triggerNum:0,runTime:0,maxTrigger:true,trigger:function(){}};$.extend(true,data,options||{});$.scrollNav.init(data);};})(jQuery);