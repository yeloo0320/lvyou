/*
 * calendar.js
 * 2016-03-15
 * 2016-06-12
 * Sheng Jiang
 * 1.0.0.0
 */
(function(window,$,lv,nova){"use strict";if(!Array.prototype.forEach){Array.prototype.forEach=function(callback,thisArg){var T,k;if(this==null){throw new TypeError(' this is null or not defined');}
var O=Object(this);var len=O.length>>>0;if(typeof callback!=="function"){throw new TypeError(callback+' is not a function');}
if(arguments.length>1){T=thisArg;}
k=0;while(k<len){var kValue;if(k in O){kValue=O[k];callback.call(T,kValue,k,O);}
k++;}};}
if(lv.calendar){return false;}
var $document=$(document);var $body=$("body");var today=new Date();var fiveMinutes=1000*60*5;var monthSize={0:31,1:28,2:31,3:30,4:31,5:30,6:31,7:31,8:30,9:31,10:30,11:31};function getEpochOfCST(){var epoch=new Date(1970,0,1);return epoch;}
function padNumber(num,digits,trim){var neg="";if(num<0){neg="-";num=-num;}
num=""+num;while(num.length<digits){num="0"+num;}
if(trim){num=num.substr(num.length-digits);}
return neg+num;}
function dateGetter(name,size,offset,trim){return function(date){var value=date["get"+name]();if(offset>0||value>-offset){value+=offset;}
if(value===0&&offset===-12){value=12;}
return padNumber(value,size,trim);}}
function dateSetter(name,size,offset,trim){return function(date,value){if(offset>0||value>-offset){value-=offset;}
if(value===0&&offset===-12){value=12;}
date["set"+name](value);}}
var DATE_FORMATS_SPLIT=/((?:[^yMdHhmsaZE']+)|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/;var DATE_FORMATS={yyyy:["FullYear",4],yy:["FullYear",2,0],MM:["Month",2,1],M:["Month",1,1],dd:["Date",2],d:["Date",1],HH:["Hours",2],H:["Hours",1],hh:["Hours",2,-12],h:["Hours",1,-12],mm:["Minutes",2],m:["Minutes",1],ss:["Seconds",2],s:["Seconds",1],E:["Day",1]};function Factory(options){options=$.extend({},Factory.defaults,options);return new Calendar(options);}
Factory.defaults={weekHeader:false,weekInterval:false,priceTipText:"因最低价实时变化，请以实际价格为准",showPriceTip:true,sectionSelect:false,allowMutiSelected:false,triggerEvent:"click",date:"",target:"body",offsetAmount:{top:0,left:0},englishWeekTitle:{0:'sun',1:'mon',2:'tue',3:'wed',4:'thu',5:'fri',6:'sat'},weekShortTitle:{0:"日",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六"},wrapClass:"",weekTitle:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},titleTip:"{{year}}年{{month}}月",template:"big",bimonthly:false,dateFormat:"yyyy-MM-dd",monthChangeOffset:1,sourceFn:null,selectDateCallback:null,cancelDateCallback:null,completeCallback:null,clearCallback:null,okCallback:null,renderReadonly:true,cascading:false,cascadingMin:1,cascadingOffset:1,cascadingMax:-1,cascadingNextAuto:true,minLimit:null,maxLimit:null,monthNext:6,monthPrev:0,dayNext:-1,dayPrev:0,dayDisableNext:0,isTodayClick:true,numberOfDays:"{{num}}晚",division:false,showNumberOfDays:false,isBirthday:false,hasTime:false,clickDocumentHide:true,festival:{'2019-01-01':{name:'元旦',vacationName:'元旦'},'2019-02-04':{name:'除夕',vacationName:'除夕'},'2019-02-05':{name:'春节',vacationName:'春节'},'2019-02-06':{vacationName:'春节假期'},'2019-02-07':{vacationName:'春节假期'},'2019-02-08':{vacationName:'春节假期'},'2019-02-09':{vacationName:'春节假期'},'2019-02-10':{vacationName:'春节假期'},'2019-04-05':{name:'清明',vacationName:'清明节'},'2019-04-06':{vacationName:'清明节假期'},'2019-04-07':{vacationName:'清明节假期'},'2019-05-01':{name:'劳动',vacationName:'劳动节'},'2019-05-02':{vacationName:'劳动节假期'},'2019-05-03':{vacationName:'劳动节假期'},'2019-05-04':{vacationName:'劳动节假期'},'2019-06-07':{name:'端午',vacationName:'端午节'},'2019-06-08':{vacationName:'端午节假期'},'2019-06-09':{vacationName:'端午节假期'},'2019-09-13':{name:'中秋',vacationName:'中秋节'},'2019-09-14':{vacationName:'中秋节假期'},'2019-09-15':{vacationName:'中秋节假期'},'2019-10-01':{name:'国庆',vacationName:'国庆节'},'2019-10-02':{vacationName:'国庆节假期'},'2019-10-03':{vacationName:'国庆节假期'},'2019-10-04':{vacationName:'国庆节假期'},'2019-10-05':{vacationName:'国庆节假期'},'2019-10-06':{vacationName:'国庆节假期'},'2019-10-07':{vacationName:'国庆节假期'},"2020-01-01":{name:"元旦",vacationName:"元旦",},"2020-01-24":{name:"除夕",vacationName:"除夕",},"2020-01-25":{name:"春节",vacationName:"春节",},"2020-01-26":{vacationName:"春节假期",},"2020-01-27":{vacationName:"春节假期",},"2020-01-28":{vacationName:"春节假期",},"2020-01-29":{vacationName:"春节假期",},"2020-01-30":{vacationName:"春节假期",},"2020-04-04":{name:"清明",vacationName:"清明节",},"2020-04-05":{vacationName:"清明节假期",},"2020-04-06":{vacationName:"清明节假期",},"2020-05-01":{name:"劳动",vacationName:"劳动节",},"2020-05-02":{vacationName:"劳动节假期",},"2020-05-03":{vacationName:"劳动节假期",},"2020-05-04":{vacationName:"劳动节假期",},"2020-05-05":{vacationName:"劳动节假期",},"2020-06-25":{name:"端午",vacationName:"端午节",},"2020-06-26":{vacationName:"端午节假期",},"2020-06-27":{vacationName:"端午节假期",},"2020-10-01":{name:"国庆",vacationName:"国庆节、中秋节",},"2020-10-02":{vacationName:"国庆节、中秋节假期",},"2020-10-03":{vacationName:"国庆节、中秋节假期",},"2020-10-04":{vacationName:"国庆节、中秋节假期",},"2020-10-05":{vacationName:"国庆节、中秋节假期",},"2020-10-06":{vacationName:"国庆节、中秋节假期",},"2020-10-07":{vacationName:"国庆节、中秋节假期",},"2020-10-08":{vacationName:"国庆节、中秋节假期",}},cascadingEndNotShowStart:false,weekOffset:0,dayOffset:0,yearTitle:"年",monthTitle:"月",todayTitle:"今天"};function Calendar(options){this.init(options);}
Calendar.now=function(){return new Date();};Calendar.pad=function(number){var r=String(number);if(r.length===1){r='0'+r;}
return r;};Calendar.isSameDay=function(dateA,dateB){if(dateA.getFullYear()!==dateB.getFullYear()){return false;}
if(dateA.getMonth()!==dateB.getMonth()){return false;}
if(dateA.getDate()!==dateB.getDate()){return false;}
return true;};Calendar.isSameMonth=function(dateA,dateB){if(dateA.getFullYear()!==dateB.getFullYear()){return false;}
if(dateA.getMonth()!==dateB.getMonth()){return false;}
return true;};Calendar.isLeapYear=function(fullYear){if((fullYear%400===0)||((fullYear%4===0)&&(fullYear%100!==0))){return true;}else{return false;}};Calendar.dateFormat=function(date,format){var text="";var match;var parts=[];var fn;while(format){match=DATE_FORMATS_SPLIT.exec(format);if(match){parts=parts.concat(match.slice(1));format=parts.pop();}else{parts.push(format);format=null;}}
parts.forEach(function(value){var dateGetterParameter=DATE_FORMATS[value];if(dateGetterParameter){text+=dateGetter.apply(this,dateGetterParameter)(date)}else{text+=value;}});return text;};Calendar.getDateFromFormattedString=function(str,format){var date=getEpochOfCST();date.setFullYear(3000);var match;var parts=[];var strParts=[];var fn;while(format){match=DATE_FORMATS_SPLIT.exec(format);if(match){parts=parts.concat(match.slice(1));format=parts.pop();var matchSize=(match[1].length);var leftStr=str.substr(0,matchSize);str=str.substr(matchSize);strParts.push(leftStr);}else{parts.push(format);strParts.push(str);}}
for(var i=0;i<parts.length;i++){var part=parts[i];var strPart=strParts[i];if(strPart==""){break}
var number=parseInt(strPart,10);var dateSetterParameter=DATE_FORMATS[part];if(dateSetterParameter){fn=dateSetter.apply(this,dateSetterParameter);if(!isNaN(number)){fn(date,number);}}}
var invalidDate=getEpochOfCST().setFullYear(3000);if(+date===+invalidDate){date=new Date();date.isInvalidDate=true;}
return date;};Calendar.getDaysBetween=function(start,end){return Math.abs(start-end)/60/60/1000/24;};Calendar.getFirstDateInMonth=function(date){return new Date(date.getFullYear(),date.getMonth(),1);};Calendar.getLastDateInMonth=function(date){return new Date(date.getFullYear(),date.getMonth()+1,0);};Calendar.getDaysInMonth=function(month,fullYear){if(month===1&&fullYear!==undefined&&Calendar.isLeapYear(fullYear)){return 29;}
return monthSize[month];};Calendar.monthOffset=function(date,monthOffset){var newDate=new Date(date);newDate.setMonth(newDate.getMonth()+monthOffset);return newDate;};Calendar.yearOffset=function(date,yearOffset){var newDate=new Date(date);newDate.setFullYear(newDate.getFullYear()+yearOffset);return newDate;};Calendar.dateOffset=function(date,dayOffset){var newDate=new Date(date);newDate.setDate(newDate.getDate()+dayOffset);return newDate;};Calendar.dateToDay=function(date){return new Date(date.getFullYear(),date.getMonth(),date.getDate());};Calendar.dayToMS=function(days){return days*1000*60*60*24;};var n=0;Calendar.prototype={version:"1.0.0.0",construction:Calendar,destruction:function(){this.unLoadCal();},initLimit:function(){var maxLimit=this.options.maxLimit;var minLimit=this.options.minLimit;if(maxLimit){this.maxLimitDate=Calendar.getDateFromFormattedString(maxLimit,this.options.dateFormat);}
if(minLimit){this.minLimitDate=Calendar.getDateFromFormattedString(minLimit,this.options.dateFormat);}},init:function(options){var template;if(options.template=="birthday"){this.isBirthday=true;}
if(typeof options.template=="object"){template=$.extend(true,{},smallTemplate);for(var temp in options.template){template[temp]=options.template[temp];}}else{switch(options.template){case"big":template=bigTemplate;break;case"birthday":template=birthdayTemplate;break;case"small":template=smallTemplate;break;default:template=smallTemplate;break;}}
options.template=template;if(options.isBirthday&&Factory.defaults.titleTip==options.titleTip){options.titleTip='<span class="cal-year-select">{{year}}'+options.yearTitle+'<i></i></span><span class="cal-month-select">{{month}}'+options.monthTitle+'<i></i></span>';}
this.options=options;this.defaults=Factory.defaults;this.wrap=this.wrap||this.initWrap();this.date=new Date();this.selected={};this.selectedTime=getEpochOfCST();this.cascadingSelected={start:null,end:null,startTime:getEpochOfCST(),endTime:getEpochOfCST()};this.cascadingIndex=0;this.id=n++;this.initLimit();this.initNow();this.loadCal();},initNow:function(){var dateStr=this.options.date;if(typeof dateStr=="string"&&dateStr!==""){this.now=Calendar.getDateFromFormattedString(dateStr,this.options.dateFormat);}else{this.now=new Date()}},initWrap:function(){var html=$.trim(this.options.template.wrap);html=this.replaceWith(html,{bimonthly:'data-bimonthly="'+this.options.bimonthly+'"',float:'data-float="'+!this.options.autoRender+'"'});return $(html);},loadCal:function(){var options=this.options;if(options.autoRender){this.render();this.bindEvent();$(options.trigger).append(this.wrap)}else{$(document).off(options.triggerEvent,options.trigger,this.triggerEventHandler);$(document).on(options.triggerEvent,options.trigger,{self:this},this.triggerEventHandler);this.triggerBlur();}},unLoadCal:function(){var options=this.options;$(document).off(options.triggerEvent,options.trigger,this.triggerEventHandler);this.unBindEvent();},triggerBlur:function(){var self=this;$document.on("click",{self:self},this.destroyHandler);},destroy:function(){this.wrap.remove();$(".calhover").remove();$(".cal-number-of-days").remove();},destroyHandler:function(e){var $target=$(e.target);var self=e.data.self;var $calendar=$target.parents(".ui-calendar");var options=self.options;if($calendar.length<=0&&options.clickDocumentHide==true){self.destroy();}},triggerEventHandler:function(e){var self=e.data.self;e.stopPropagation();var $this=$(this);var date;if(self.options.cascading){var start=self.cascadingSelected.start;var end=self.cascadingSelected.end;var $triggers=$(self.options.trigger);var $triggerFirst=$triggers.first();var triggerFirstValue=$triggerFirst.val();var $triggerLast=$triggers.last();var triggerLastValue=$triggerLast.val();if(!start){if(triggerFirstValue){start=triggerFirstValue;self.cascadingSelected.start=start}}
if(!end){if(triggerLastValue){end=triggerLastValue;self.cascadingSelected.end=end}}
var index=$triggers.index($this);if(index==0){if(start){date=Calendar.getDateFromFormattedString(start,self.options.dateFormat);}}else if(index==1){if(end){date=Calendar.getDateFromFormattedString(end,self.options.dateFormat);}}
if(date){self.now=date;}}else{var value=$this.val();if(value){date=Calendar.getDateFromFormattedString(value,self.options.dateFormat);self.selected={};self.selected[value]=true;self.now=date;}}
if($this.is("[readonly]")&&!self.options.renderReadonly){return false;}
self.$trigger=$this;var offset=self.getOffset();self.wrap.css({"top":offset.top,"left":offset.left});var zIndex=self.options.zIndex;if(zIndex){self.wrap.css("z-index",zIndex);}
var $target=$(self.options.target);$('.ui-calendar[data-float=true]').remove();$target.append(self.wrap);self.render();self.bindEvent();},getOffset:function(){var $trigger=this.$trigger;var offsetAmount=this.options.offsetAmount;var top=this.getInt($trigger.offset().top+$trigger.outerHeight(false)+offsetAmount.top);var left=this.getInt($trigger.offset().left+offsetAmount.left);return{top:top,left:left};},getInt:function(floatNumber){var intNumber=parseInt(floatNumber,10);return intNumber;},bindEvent:function(){this.bindMonthChangeEvent();this.bindSelectEvent();this.bindMouseOverEvent();this.bindMouseLeaveEvent();this.bindBirthdayEvent();},bindBirthdayEvent:function(){this.wrap.off("click",this.hideDropdownHandler);this.wrap.on("click",{self:this},this.hideDropdownHandler);this.wrap.off("click",".cal-year-select",this.yearDropdownHandler);this.wrap.on("click",".cal-year-select",{self:this},this.yearDropdownHandler);this.wrap.off("click",".cal-month-select",this.monthDropdownHandler);this.wrap.on("click",".cal-month-select",{self:this},this.monthDropdownHandler);this.wrap.off("click",".cal-year-dropdown li",this.yearSelectHandler);this.wrap.on("click",".cal-year-dropdown li",{self:this},this.yearSelectHandler);this.wrap.off("click",".cal-month-dropdown li",this.monthSelectHandler);this.wrap.on("click",".cal-month-dropdown li",{self:this},this.monthSelectHandler);this.wrap.off("click",".cal-birthday-clear",this.birthdayClearHandler);this.wrap.on("click",".cal-birthday-clear",{self:this},this.birthdayClearHandler);this.wrap.off("click",".cal-birthday-ok",this.birthdayOkHandler);this.wrap.on("click",".cal-birthday-ok",{self:this},this.birthdayOkHandler);this.wrap.off("click",".cal-hour",this.birthdayHourHandler);this.wrap.on("click",".cal-hour",{self:this},this.birthdayHourHandler);this.wrap.off("click",".cal-minute",this.birthdayMinuteHandler);this.wrap.on("click",".cal-minute",{self:this},this.birthdayMinuteHandler);this.wrap.off("click",".cal-hour-dropdown li",this.hourSelectHandler);this.wrap.on("click",".cal-hour-dropdown li",{self:this},this.hourSelectHandler);this.wrap.off("click",".cal-minute-dropdown li",this.minuteSelectHandler);this.wrap.on("click",".cal-minute-dropdown li",{self:this},this.minuteSelectHandler);this.wrap.off("click",".cal-minute-dropdown .close",this.minuteCloseHandler);this.wrap.on("click",".cal-minute-dropdown .close",{self:this},this.minuteCloseHandler);this.wrap.off("click",".cal-hour-dropdown .close",this.hourCloseHandler);this.wrap.on("click",".cal-hour-dropdown .close",{self:this},this.hourCloseHandler);},hourCloseHandler:function(e){e.stopPropagation();var self=e.data.self;var $hourDropdown=self.wrap.find(".cal-hour-dropdown");$hourDropdown.remove();self.wrap.find(".cal-hour").removeClass("active");},minuteCloseHandler:function(e){e.stopPropagation();var self=e.data.self;var $minuteDropdown=self.wrap.find(".cal-minute-dropdown");$minuteDropdown.remove();self.wrap.find(".cal-minute").removeClass("active");},validateTime:function(){var cascadingSelected=this.cascadingSelected;if(cascadingSelected.start&&(cascadingSelected.start==cascadingSelected.end)){var startTime=cascadingSelected.startTime;var endTime=cascadingSelected.endTime;var lastTime=getEpochOfCST();lastTime.setHours(23);lastTime.setMinutes(55);if(+startTime==+lastTime){this.cascadingSelected.end=null;this.cascadingSelected.endTime=getEpochOfCST();}else if(startTime>=endTime){startTime=new Date(startTime.getTime()+fiveMinutes);this.cascadingSelected.endTime.setTime(startTime);}}},hourSelectHandler:function(e){e.stopPropagation();var self=e.data.self;var $this=$(this);if($this.is('[data-disabled="true"]')){return false;}
var hourStr=$this.attr("data-hour");var hour=parseInt(hourStr,10);var $calHour=self.wrap.find(".cal-hour");if(self.options.cascading){if(self.cascadingIndex===0){self.cascadingSelected.startTime.setHours(hour);}else{self.cascadingSelected.endTime.setHours(hour);}
self.validateTime();}else{self.selectedTime.setHours(hour);}
var $hourDropdown=self.wrap.find(".cal-hour-dropdown");$hourDropdown.remove();$calHour.html(hourStr).removeClass("active");},minuteSelectHandler:function(e){e.stopPropagation();var self=e.data.self;var $this=$(this);if($this.is('[data-disabled="true"]')){return false;}
var minuteStr=$this.attr("data-minute");var $calMinute=self.wrap.find(".cal-minute");var minute=parseInt(minuteStr,10);if(self.options.cascading){if(self.cascadingIndex===0){self.cascadingSelected.startTime.setMinutes(minute);}else{self.cascadingSelected.endTime.setMinutes(minute);}
self.validateTime();}else{self.selectedTime.setMinutes(minute);}
var $minuteDropdown=self.wrap.find(".cal-minute-dropdown");$minuteDropdown.remove();$calMinute.html(minuteStr).removeClass("active");},birthdayHourHandler:function(e){var self=e.data.self;var $this=$(this);var val=$this.html();$this.addClass("active");self.wrap.find(".cal-hour-dropdown").remove();self.wrap.find(".cal-minute-dropdown").remove();var $hourDropdown=$(''+'<div class="cal-hour-dropdown">'+'<div class="title">小时<div class="close"><i></i></div></div>'+'</div>');var $ul=$("<ul></ul>");var liArr=[];var activeClass;var startHour=0;var disabled;if(self.options.cascading&&self.cascadingIndex===1){var start=self.cascadingSelected.start;var end=self.cascadingSelected.end;var startTime=self.cascadingSelected.startTime;if(start&&(start==end)){startHour=startTime.getHours();}}
for(var i=0;i<24;i+=1){var dataHour=padNumber(i,2);if(dataHour==val){activeClass=true;}else{activeClass=false;}
if(i<startHour){disabled=true;}else{disabled=false;}
liArr.push(''+'<li'+' class="'+(activeClass?'active':'')+'"'+' data-disabled="'+(disabled?'true':'false')+'"'+' data-hour="'+dataHour+'">'+
i+'</li>');}
var liStr=liArr.join("");$ul.html(liStr);$hourDropdown.append($ul);self.wrap.append($hourDropdown);},birthdayMinuteHandler:function(e){var $this=$(this);var self=e.data.self;$this.addClass("active");var val=$this.html();var startMinute=0;var disabled;var sameDayAndHour=false;self.wrap.find(".cal-hour-dropdown").remove();self.wrap.find(".cal-minute-dropdown").remove();if(self.options.cascading&&self.cascadingIndex===1){var start=self.cascadingSelected.start;var end=self.cascadingSelected.end;var startTime=self.cascadingSelected.startTime;var endTime=self.cascadingSelected.endTime;if(start&&(start==end)){var startHour=startTime.getHours();var endHour=endTime.getHours();if(startHour===endHour){sameDayAndHour=true;startMinute=startTime.getMinutes();}}}
var $minuteDropdown=$(''+'<div class="cal-minute-dropdown">'+'<div class="title">分钟<div class="close"><i></i></div></div>'+'</div>');var $ul=$("<ul></ul>");var liArr=[];var activeClass;for(var i=0;i<60;i+=5){var dataMinute=padNumber(i,2);if(dataMinute==val){activeClass=true;}else{activeClass=false;}
if(sameDayAndHour&&(i<startMinute+5)){disabled=true;}else{disabled=false;}
liArr.push(''+'<li class="'+(activeClass?'active':'')+'"'+' data-disabled="'+(disabled?'true':'false')+'"'+' data-minute="'+dataMinute+'">'+i+'</li>');}
var liStr=liArr.join("");$ul.html(liStr);$minuteDropdown.append($ul);self.wrap.append($minuteDropdown);},birthdayOkHandler:function(e){e.stopPropagation();var self=e.data.self;self.inputTime();self.destroy();var okCallback=self.options.okCallback;if(okCallback&&$.isFunction(okCallback)){okCallback.call(self,self);}
self.toNextCal();},inputTime:function(){var self=this;var date;var start=self.cascadingSelected.start;var end=self.cascadingSelected.end;var result;if(self.options.cascading){if((self.cascadingIndex===0)&&start){date=Calendar.getDateFromFormattedString(start,self.options.dateFormat);result=self.getDateResult(date);}else if(end){date=Calendar.getDateFromFormattedString(end,self.options.dateFormat);result=self.getDateResult(date);}
if(result){self.$trigger.val(result);}}},birthdayClearHandler:function(e){var self=e.data.self;self.$trigger.val("");if(self.options.cascading){if(self.cascadingIndex===0){self.cascadingSelected.start=null;self.cascadingSelected.startTime=getEpochOfCST();}else{self.cascadingSelected.end=null;self.cascadingSelected.endTime=getEpochOfCST();}}else{self.selected={};self.selectedTime=getEpochOfCST();}
self.destroy();var clearCallback=self.options.clearCallback;if(clearCallback&&$.isFunction(clearCallback)){clearCallback.call(self,self);}
e.stopPropagation();},monthSelectHandler:function(e){var self=e.data.self;var $this=$(this);var selectedMonth=$this.attr("data-month");var month=parseInt(selectedMonth,10);self.now.setDate(1);self.now.setMonth(month);self.render();self.bindEvent();e.stopPropagation();},limitDropdown:function(){var minLimitDate=this.minLimitDate;var maxLimitDate=this.maxLimitDate;var now=this.now;var nowYear=now.getFullYear();var nowMonth=now.getMonth();if(minLimitDate&&nowYear==minLimitDate.getFullYear()){var minMonth=minLimitDate.getMonth();if(nowMonth<minMonth){this.now.setDate(1);this.now.setMonth(minMonth)}}
if(maxLimitDate&&nowYear==maxLimitDate.getFullYear()){var maxMonth=maxLimitDate.getMonth();if(nowMonth>maxMonth){this.now.setDate(1);this.now.setMonth(maxMonth)}}},yearSelectHandler:function(e){var self=e.data.self;var $this=$(this);var selectedYear=$this.attr("data-year");var year=parseInt(selectedYear,10);self.now.setFullYear(year);self.limitDropdown();self.render();self.bindEvent();e.stopPropagation();},hideDropdownHandler:function(e){var self=e.data.self;var $target=$(e.target);var $yearDropdown=self.wrap.find(".cal-year-dropdown-box");var $monthDropdown=self.wrap.find(".cal-month-dropdown-box");var $hourDropdown=self.wrap.find(".cal-hour-dropdown");var $minuteDropdown=self.wrap.find(".cal-minute-dropdown");var $hour=self.wrap.find(".cal-hour");var $minute=self.wrap.find(".cal-minute");$yearDropdown.hide();$monthDropdown.hide();$hourDropdown.hide();$minuteDropdown.hide();$hour.removeClass("active");$minute.removeClass("active");if($target.is(".cal-year-select")||$target.parents(".cal-year-select").length>0){$yearDropdown.show();}
if($target.is(".cal-month-select")||$target.parents(".cal-month-select").length>0){$monthDropdown.show();}
if($target.is(".cal-hour")||$target.is(".cal-hour-dropdown")||$target.parents(".cal-hour-dropdown").length>0){$hourDropdown.show();$hour.addClass("active");}
if($target.is(".cal-minute")||$target.is(".cal-minute-dropdown")||$target.parents(".cal-minute-dropdown").length>0){$minuteDropdown.show();$minute.addClass("active");}},yearDropdownHandler:function(e){var self=e.data.self;var $this=$(this);var $yearDropdown=self.wrap.find(".cal-year-dropdown-box");if($yearDropdown.length<=0){$yearDropdown=self.createYearDropdown($this);}
if($this.hasClass("active")){$yearDropdown.hide();}else{$yearDropdown.show();}
var calOffset={top:self.wrap.offset().top,left:self.wrap.offset().left};var offset={top:$this.offset().top,left:$this.offset().left};var calDate=self.now;var calYear=calDate.getFullYear();var $yearCurrentLi=$yearDropdown.find("[data-year="+calYear+"]");$yearDropdown.css({top:offset.top-calOffset.top,left:offset.left-calOffset.left});self.wrap.append($yearDropdown);$yearCurrentLi.addClass("active");var currentLiHeight=$yearCurrentLi.outerHeight();var currentLiIndex=$yearCurrentLi.index();var currentLiTop=currentLiHeight*currentLiIndex;$yearDropdown.find(".cal-year-dropdown").scrollTop(currentLiTop)},monthDropdownHandler:function(e){var self=e.data.self;var $this=$(this);var $monthDropdown=self.wrap.find(".cal-month-dropdown-box");if($monthDropdown.length<=0){$monthDropdown=self.createMonthDropdown($this);}
if($this.hasClass("active")){$monthDropdown.hide();}else{$monthDropdown.show();}
var calOffset={top:self.wrap.offset().top,left:self.wrap.offset().left};var offset={top:$this.offset().top,left:$this.offset().left};var calDate=self.now;var calMonth=calDate.getMonth();var $yearCurrentLi=$monthDropdown.find("[data-month="+calMonth+"]");$monthDropdown.css({top:offset.top-calOffset.top,left:offset.left-calOffset.left});self.wrap.append($monthDropdown);$yearCurrentLi.addClass("active");var currentLiHeight=$yearCurrentLi.outerHeight();var currentLiIndex=$yearCurrentLi.index();var currentLiTop=currentLiHeight*currentLiIndex;$monthDropdown.scrollTop(currentLiTop)},createMonthDropdown:function(){var minLimitDate=this.minLimitDate;var maxLimitDate=this.maxLimitDate;var minYear=minLimitDate?minLimitDate.getFullYear():1900;var maxYear=maxLimitDate?maxLimitDate.getFullYear():2099;var minMonth=0;var maxMonth=11;var nowYear=this.now.getFullYear();if(nowYear==minYear&&minLimitDate){minMonth=minLimitDate.getMonth();}
if(nowYear==maxYear&&maxLimitDate){maxMonth=maxLimitDate.getMonth();}
var $dropdownBox=$(''+'<div class="cal-month-dropdown-box">'+'    <div class="cal-month-select-active">'+(this.now.getMonth()+1)+this.options.monthTitle+'<i></i></div>'+'</div>');var $ul=$('<ul class="cal-month-dropdown"></ul>');$dropdownBox.append($ul);var liStr=[];for(var index=minMonth;index<=maxMonth;index++){liStr.push('<li data-month="'+index+'">'+(index+1)+'</li>');}
$ul.html(liStr.join(""));return $dropdownBox;},createYearDropdown:function(){var minLimitDate=this.minLimitDate;var maxLimitDate=this.maxLimitDate;var minYear=minLimitDate?minLimitDate.getFullYear():1900;var maxYear=maxLimitDate?maxLimitDate.getFullYear():2099;var $dropdownBox=$(''+'<div class="cal-year-dropdown-box">'+'    <div class="cal-year-select-active">'+this.now.getFullYear()+this.options.yearTitle+'<i></i></div>'+'</div>');var $ul=$('<ul class="cal-year-dropdown"></ul>');$dropdownBox.append($ul);var liStr=[];for(var i=minYear;i<=maxYear;i++){liStr.push('<li data-year="'+i+'">'+i+'</li>');}
$ul.html(liStr.join(""));return $dropdownBox;},bindMouseOverEvent:function(){this.wrap.off("mouseenter","[data-date-map]",this.bindMouseOverHandler);this.wrap.on("mouseenter","[data-date-map]",{self:this},this.bindMouseOverHandler);},bindMouseLeaveEvent:function(){this.wrap.off("mouseleave","[data-date-map]",this.bindMouseLeaveHandler);this.wrap.on("mouseleave","[data-date-map]",{self:this},this.bindMouseLeaveHandler);},bindMouseLeaveHandler:function(e){var self=e.data.self;if(self.options.cascading){self.hideNumberOfDays();self.renderSelected(false,false);}
if(self.options.sectionSelect){self.renderSelected(false,false);}},bindMouseOverHandler:function(e){var self=e.data.self;var $this=$(this);var dateStr=$this.attr("data-date-map");if(self.options.cascading){if(!$this.children().is(".nodate,.caldisabled")){if(!self.options.cascadingEndNotShowStart){self.renderSelected(dateStr,false);}}}
if(self.options.sectionSelect&&self.sectionSelectFlag){if(!$this.children().is(".notThisMonth,.nodate")){self.renderSelected(dateStr,false);}}},bindSelectEvent:function(){this.wrap.off("click","[data-date-map]",this.bindSelectHandler);this.wrap.on("click","[data-date-map]",{self:this},this.bindSelectHandler);},getDateResult:function(dateVal){var self=this;if(self.options.cascading){if(self.cascadingIndex===0){var startTime=self.cascadingSelected.startTime;dateVal.setHours(startTime.getHours());dateVal.setMinutes(startTime.getMinutes());}else{var endTime=self.cascadingSelected.endTime;dateVal.setHours(endTime.getHours());dateVal.setMinutes(endTime.getMinutes());}}else{var time=self.selectedTime;dateVal.setHours(time.getHours());dateVal.setMinutes(time.getMinutes());}
var dateResult=Calendar.dateFormat(dateVal,self.options.dateFormat);return dateResult;},canSectionSelect:function(td,self,date){var hasProductStr=td.attr("data-has-product");var hasProduct=false;if(hasProductStr=="true"){hasProduct=true;}
var canSelect=0;if(!self.sectionSelectFlag){if(hasProduct){self.sectionSelectFlag=true;self.sectionSelectEnd=null;self.sectionSelectStart=date;self.sectionSelectEnd=Calendar.dateOffset(date,1)}}else{var middle;var sectionSelectStart;var sectionSelectEnd;var middleStr;if(+self.sectionSelectStart==+date){}else{if(self.sectionSelectStart>date){if(hasProduct){return 4;}else{return 3;}}else{sectionSelectStart=self.sectionSelectStart;sectionSelectEnd=date;}
canSelect=1;middle=Calendar.dateOffset(sectionSelectStart,1);while(middle<sectionSelectEnd){middleStr=Calendar.dateFormat(middle,self.options.dateFormat);var $middle=self.wrap.find('[data-date-map='+middleStr+']');if($middle.attr("data-has-product")!=="true"){canSelect=2;break;}
middle=Calendar.dateOffset(middle,1);}}}
return canSelect;},bindSelectHandler:function(e){e.stopPropagation();var self=e.data.self;var selectDateCallback=self.options.selectDateCallback;var cancelDateCallback=self.options.cancelDateCallback;var autoRender=self.options.autoRender;var $this=$(this);function runSelectDateCallback(){if(selectDateCallback){selectDateCallback.call(self,self,$this);}}
function runCancelDateCallback(){if(cancelDateCallback){cancelDateCallback.call(self,self,$this);}}
if($this.children().first().is(".nodate,.caldisabled")){}else if($this.children().is(".notThisMonth")&&self.options.bimonthly){}else{var dateStr=$this.attr("data-date-map");var format=self.options.dateFormat;if(dateStr){var date=Calendar.getDateFromFormattedString(dateStr,format);if(!self.options.sectionSelect){self.now=new Date(date);}}
var end=self.cascadingSelected.end;if(end){var endDate=Calendar.getDateFromFormattedString(end,format);}
if(self.options.cascading){}else if(self.options.sectionSelect){var canSelect=self.canSectionSelect($this,self,date);if(canSelect==1||canSelect==2){self.sectionSelectFlag=false;self.sectionSelectEnd=date;}
if(canSelect==1||canSelect==0||canSelect==4){runSelectDateCallback()}else{runCancelDateCallback()}
if(canSelect==4){self.sectionSelectFlag=true;self.sectionSelectStart=date
self.sectionSelectEnd=Calendar.dateOffset(date,1);}
self.renderSelected();self.bindEvent();}else{var hasInventory=$this.children().hasClass("hasInventory");if(self.options.allowMutiSelected){var isSelect=$this.is(".td-selected");if(isSelect){delete self.selected[dateStr];$this.removeClass("td-selected");if(autoRender){runCancelDateCallback();}}else{self.selected[dateStr]=true;$this.addClass("td-selected");if(autoRender){runSelectDateCallback();}}}else{self.selected={};self.selected[dateStr]=true;var $date=self.wrap.find("[data-date-map]");$date.removeClass("td-selected");$this.addClass("td-selected");if(autoRender){runSelectDateCallback();}}}}
if(!autoRender){var $td=$this;if($this.find(".nodate,.caldisabled").length>0){return false;}
if($this.children().is(".notThisMonth")&&self.options.bimonthly){return false;}
var dateMap=$td.attr("data-date-map");var dateVal=Calendar.getDateFromFormattedString(dateMap,self.options.dateFormat);var dateResult=self.getDateResult(dateVal);self.$trigger.val(dateResult);runSelectDateCallback();if(self.options.cascading){if(self.cascadingIndex===0){self.cascadingSelected.start=dateMap}else{self.cascadingSelected.end=dateMap}
if(self.cascadingIndex===0&&end&&dateStr){var max=self.options.cascadingMax;var min=self.options.cascadingMin;var offset=self.options.cascadingOffset;var dayNext=self.options.dayNext;var thisDate=Calendar.dateToDay(self.date);var newEndDate;var maxDate=new Date(+date+Calendar.dayToMS(max));if(maxDate<endDate&&max!=-1){newEndDate=Calendar.dateFormat(maxDate,format);self.cascadingSelected.end=newEndDate;}
var offsetDate=new Date(+date+Calendar.dayToMS(offset));if(offsetDate>endDate){newEndDate=Calendar.dateFormat(offsetDate,format);self.cascadingSelected.end=newEndDate;}
if(dayNext!=-1){var lastDate=Calendar.dateOffset(thisDate,dayNext);if(offsetDate&&(+offsetDate>+lastDate)){newEndDate=Calendar.dateFormat(lastDate,format);self.cascadingSelected.end=newEndDate;}}}
self.validateTime();if(!self.options.hasTime){self.destroy();self.toNextCal();}else{self.dateValidate();self.render();self.bindEvent();}}else{self.destroy();}}},unBindEvent:function(){this.unBindMonthChangeEvent();},bindMonthChangeEvent:function(){var monthChangeOffset=this.options.monthChangeOffset||1;var $monthPrev=this.wrap.find(".month-prev");var $monthNext=this.wrap.find(".month-next");$monthPrev.off("click",this.monthChangeHandler);$monthPrev.on("click",{self:this,monthOffset:-monthChangeOffset},this.monthChangeHandler);$monthNext.off("click",this.monthChangeHandler);$monthNext.on("click",{self:this,monthOffset:+monthChangeOffset},this.monthChangeHandler);},unBindMonthChangeEvent:function(){var $monthPrev=this.wrap.find(".month-prev");var $monthNext=this.wrap.find(".month-next");$monthPrev.off("click",this.monthChangeHandler);$monthNext.off("click",this.monthChangeHandler);},dateValidate:function(){var $triggers=$(this.options.trigger);var end=this.cascadingSelected.end;if(end){var endDate=Calendar.getDateFromFormattedString(end,this.options.dateFormat);var endTime=this.cascadingSelected.endTime;endDate.setHours(endTime.getHours());endDate.setMinutes(endTime.getMinutes());var endDateStr=Calendar.dateFormat(endDate,this.options.dateFormat);$triggers.eq(1).val(endDateStr);}else{$triggers.eq(1).val("");}},toNextCal:function(){var $triggers=$(this.options.trigger);var triggerSize=$triggers.length;var cascadingCallback=this.options.cascadingCallback;this.dateValidate();if(this.options.cascadingNextAuto){var index=$triggers.index(this.$trigger);if(triggerSize-1==index){}else{var eventName=this.options.triggerEvent;$triggers.eq(index+1).trigger(eventName);if(cascadingCallback){cascadingCallback.call(this,this,$triggers.eq(index+1));}}}},monthLimit:function(){var mosNext=this.options.monthNext;var mosPrev=this.options.monthPrev;var upperLimit=Calendar.monthOffset(Calendar.getFirstDateInMonth(today),mosNext);var lowerLimit=Calendar.monthOffset(Calendar.getFirstDateInMonth(today),-mosPrev);if(mosNext!=-1&&Calendar.isSameMonth(upperLimit,this.now)){this.hideMonthNext();}
if(mosPrev!=-1&&Calendar.isSameMonth(lowerLimit,this.now)){this.hideMonthPrev();}},DateLimit:function(){if(this.maxLimitDate){var isSameMonthNext=Calendar.isSameMonth(this.maxLimitDate,this.now);if(isSameMonthNext){this.hideMonthNext();}}
if(this.minLimitDate){var isSameMonthPrev=Calendar.isSameMonth(this.minLimitDate,this.now);if(isSameMonthPrev){this.hideMonthPrev();}}},hideMonthNext:function(){this.wrap.find(".month-next").hide();},hideMonthPrev:function(){this.wrap.find(".month-prev").hide();},showMonthNext:function(){this.wrap.find(".month-next").show();},showMonthPrev:function(){this.wrap.find(".month-prev").show();},monthChangeHandler:function(e){var self=e.data.self;var monthOffset=e.data.monthOffset;self.now.setDate(1);self.now=Calendar.monthOffset(self.now,monthOffset);self.render();self.bindEvent();e.stopPropagation();},toMonth:function(yearStr,monthStr){var year=parseInt(yearStr,10);var month=parseInt(monthStr,10)-1;if(typeof year==="number"){this.now.setFullYear(year);}
if(typeof month==="number"){this.now.setDate(1);this.now.setMonth(month);}
this.render();this.bindEvent();},hideNumberOfDays:function(){$(".cal-number-of-days").hide();},render:function(disableCallback){var self=this;if(this.options.cascading){var $trigger=self.$trigger;var $triggers=$(self.options.trigger);this.cascadingIndex=$triggers.index($trigger);}
this.hideNumberOfDays();this.wrap.html("");this.wrap.append(this.createHead());this.wrap.append(this.createBody());if(this.wrap.is(".ui-calendar-big")&&this.options.showPriceTip){this.wrap.append("<div class='nova-calendar-tip'><i></i>"+this.options.priceTipText+"</div>")}
var sourceFn=this.options.sourceFn;if(!disableCallback&&$.isFunction(sourceFn)){sourceFn.call(self,self);}
this.wrap.addClass(this.options.wrapClass);var completeCallback=this.options.completeCallback;this.renderFestival();this.renderSelected(false,true);this.renderTime();this.monthLimit();this.DateLimit();if(!disableCallback&&$.isFunction(completeCallback)){completeCallback.call(this,this);}},renderTime:function(){if(this.options.hasTime){this.wrap.find(".cal-pane").children().css({"display":"inline-block"});}
if(this.options.cascading){this.renderCascadingTime();}else{this.renderNormalTime();}},setTimeHtml:function(time){var hour=time.getHours();var minute=time.getMinutes();var hourStr=padNumber(hour,2);var minuteStr=padNumber(minute,2);var $hour=this.wrap.find(".cal-hour");var $minute=this.wrap.find(".cal-minute");$hour.html(hourStr);$minute.html(minuteStr);},renderNormalTime:function(){this.setTimeHtml(this.selectedTime);},renderCascadingTime:function(){var startTime=this.cascadingSelected.startTime;var endTime=this.cascadingSelected.endTime;if(this.cascadingIndex===0){this.setTimeHtml(startTime);}else if(this.cascadingIndex===1){this.setTimeHtml(endTime);}},renderSelected:function(mouseOverEnd,isClick){var self=this;var selected=this.selected;var $dates=this.wrap.find("[data-date-map]").has(".caldate");var cascadingMin=this.options.cascadingMin;var cascadingMax=self.options.cascadingMax;var cascadingEndNotShowStart=self.options.cascadingEndNotShowStart;$dates.children().removeClass("calmiddle");var dateFormat=self.options.dateFormat;if(self.options.cascading){var start=self.cascadingSelected.start;var end=mouseOverEnd||self.cascadingSelected.end;var $startDate=$dates.filter('[data-date-map="'+start+'"]').has(".caldate");var $endDate=$dates.filter('[data-date-map="'+end+'"]').has(".caldate");if(start){var startDate=Calendar.getDateFromFormattedString(start,dateFormat);}
if(end){var endDate=Calendar.getDateFromFormattedString(end,dateFormat);}
if(this.cascadingIndex===0){}else{if(start){$dates.each(function(index,domEle){var $date=$(domEle);var dateStr=$date.attr("data-date-map");var date=Calendar.getDateFromFormattedString(dateStr,self.options.dateFormat);if(end){if(date>startDate&&date<endDate){if(!self.options.cascadingEndNotShowStart){$date.children().addClass("calmiddle");}}}
if(cascadingMin!=-1){if(date<+startDate+Calendar.dayToMS(cascadingMin)){$date.children().addClass("caldisabled")}}
if(cascadingMax!=-1){if(date>+startDate+Calendar.dayToMS(cascadingMax)){$date.children().addClass("caldisabled");}}});if(end&&$endDate.length>0){var numberOfDays=Calendar.getDaysBetween(startDate,endDate);var size={width:$endDate.width(),height:$endDate.height(),left:$endDate.offset().left,top:$endDate.offset().top};var $numberOfDays=$(".cal-number-of-days");if($numberOfDays.length<=0){$numberOfDays=$(''+'<div class="cal-number-of-days">'+'    <div class="triangle"></div>'+'    <span></span>'+'</div>');}
$numberOfDays.css({left:0,top:0});var $numberOfDaysSpan=$numberOfDays.children("span");var template=self.options.numberOfDays;var numberOfDaysHtml=self.replaceWith(template,{num:numberOfDays});$numberOfDaysSpan.html(numberOfDaysHtml);$body.append($numberOfDays);var width=$numberOfDays.width();$numberOfDays.css({left:size.left-~~(width-size.width/2)+2,top:size.top+size.height+7});if(self.options.zIndex){$numberOfDays.css("zIndex",self.options.zIndex+1);}
if(self.options.showNumberOfDays){$numberOfDays.show();}}}
if(end){if(!mouseOverEnd){$endDate.addClass("td-selected");}}}
if(end&&mouseOverEnd&&!self.options.hasTime){$dates.removeClass("td-selected");}
if(start&&!((cascadingEndNotShowStart&&this.cascadingIndex===1))){$startDate.addClass("td-selected")}}
if(self.options.sectionSelect){var $wrap=self.wrap;var $tds=$wrap.find("td[data-date-map]").filter(function(index,ele){var $ele=$(ele);if($ele.find(".notThisMonth").length>0){return false}else{return true;}});$tds.removeClass("td-selected").children().removeClass("calmiddle").find(".calday").each(function(index,ele){var $ele=$(ele);var backup=$ele.attr("data-backup");if(backup){$ele.text(backup);}});var sectionSelectStart=self.sectionSelectStart;var sectionSelectEnd=self.sectionSelectEnd;if(mouseOverEnd){sectionSelectEnd=Calendar.getDateFromFormattedString(mouseOverEnd,self.options.dateFormat);}
if(+sectionSelectStart==+sectionSelectEnd){return;}
if(sectionSelectStart&&sectionSelectEnd){if(+sectionSelectStart>+sectionSelectEnd){sectionSelectStart=null;sectionSelectEnd=null;if(!mouseOverEnd){self.sectionSelectStart=sectionSelectStart;self.sectionSelectEnd=sectionSelectEnd;}}
var middle=Calendar.dateOffset(sectionSelectStart,1);var $middle;var middleStr;while(+middle<+sectionSelectEnd){middleStr=Calendar.dateFormat(middle,dateFormat);$middle=$tds.filter('td[data-date-map='+middleStr+']');$middle.children().addClass("calmiddle");middle=Calendar.dateOffset(middle,1);}}
if(sectionSelectStart){var sectionSelectStartStr=Calendar.dateFormat(sectionSelectStart,dateFormat);var $start=$tds.filter('td[data-date-map='+sectionSelectStartStr+']');$start.addClass("td-selected");var $startCalDay=$start.find(".calday");$startCalDay.attr("data-backup",$startCalDay.text()).text("入住");}
if(sectionSelectEnd){var sectionSelectEndStr=Calendar.dateFormat(sectionSelectEnd,dateFormat);var $end=$tds.filter('td[data-date-map='+sectionSelectEndStr+']');$end.addClass("td-selected");var $endCalDay=$end.find(".calday");$endCalDay.attr("data-backup",$endCalDay.text()).text("退房");}}
$dates.each(function(index,domEle){var $td=$(domEle);if(!$td.find(".nodate").length>0){var date=$td.attr("data-date-map");if(self.selected[date]){if(self.options.autoRender){$td.addClass("td-selected");}else{if(self.$trigger.val()!=""){$td.addClass("td-selected");}}
var $thisTd=self.wrap.find('[data-date-map="'+date+'"]');if($thisTd.length>1){$thisTd.has(".notThisMonth").removeClass("td-selected");}}}});},renderFestival:function(){var festival=this.options.festival;var self=this;var $tds=this.wrap.find('td[data-date-map]');var dateToday=new Date(self.date.getFullYear(),self.date.getMonth(),self.date.getDate());var dateTodayStr=Calendar.dateFormat(dateToday,self.options.dateFormat);$tds.each(function(i,domEle){var $td=$(domEle);var $date=$td.find(".caldate");var $calActive=$date.find(".calactive");var $calday=$date.find(".calday");var date=$td.attr("data-date-map");var tdFestival=festival[date];if(tdFestival){if($(self.wrap).is(".ui-calendar-mini")){if(tdFestival.name){$date.html(tdFestival.name);$date.addClass("festival");}}else{var $calFestival=$('<div class="calfestival">休</div>');$calActive.append($calFestival);if(tdFestival.name){$date.addClass("festival");$calday.html(tdFestival.name);}}}
if(dateTodayStr===date&&self.options.todayTitle!=null){if($(self.wrap).is(".ui-calendar-mini")){$date.html(self.options.todayTitle);}else{$calday.html(self.options.todayTitle);}}
var thisDate=Calendar.getDateFromFormattedString(date,self.options.dateFormat);var thisDateMonth=thisDate.getMonth();var thisDateDay=thisDate.getDate();if(self.options.division&&thisDateDay==1){if($(self.wrap).is(".ui-calendar-mini")){}else{$calday.html((thisDateMonth+1)+"月"+thisDateDay+"日");}}})},createHead:function(){return this.options.template.calControl;},createBody:function(){var options=this.options;var html="";var date=this.now;html+=this.createSingleCalendar(date,0);if(options.bimonthly){var nextMonthDate=new Date(date);nextMonthDate.setDate(1);nextMonthDate=Calendar.monthOffset(nextMonthDate,1);html+=this.createSingleCalendar(nextMonthDate,1);}
html=this.replaceWith(options.template.calWrap,{content:html});return html;},createSingleCalendar:function(date,offset){var html="";var options=this.options;var month=date.getMonth();var year=date.getFullYear();var nextMonthDate=Calendar.monthOffset(Calendar.getFirstDateInMonth(date),1);var nextMonthYear=nextMonthDate.getFullYear();var nextMonthMonth=nextMonthDate.getMonth();var weekHeaderTh="";if(this.options.weekHeader){weekHeaderTh='<th class="ui-calendar-week-header"></th>';}
html+=this.replaceWith(options.template.calTitle,{month:this.replaceWith(options.titleTip,{year:year,month:month+1})});if(this.options.division){var nextMonthTitle=this.replaceWith(options.template.calTitle,{month:this.replaceWith(options.titleTip,{year:nextMonthYear,month:nextMonthMonth+1})});nextMonthTitle=nextMonthTitle.replace("caltitle","caltitle caltitlenext");html+=nextMonthTitle}
var weekOffset=this.options.weekOffset;var dayOffset=this.options.dayOffset;var englishWeekTitle=this.options.englishWeekTitle;var weekShortTitle=this.options.weekShortTitle;html+=this.replaceWith(options.template.calBody,{month:month+1,date:this.createDate(date),'weekHeader':weekHeaderTh,'englishWeekTitle[0]':englishWeekTitle[(0+weekOffset+dayOffset)%7],'englishWeekTitle[1]':englishWeekTitle[(1+weekOffset+dayOffset)%7],'englishWeekTitle[2]':englishWeekTitle[(2+weekOffset+dayOffset)%7],'englishWeekTitle[3]':englishWeekTitle[(3+weekOffset+dayOffset)%7],'englishWeekTitle[4]':englishWeekTitle[(4+weekOffset+dayOffset)%7],'englishWeekTitle[5]':englishWeekTitle[(5+weekOffset+dayOffset)%7],'englishWeekTitle[6]':englishWeekTitle[(6+weekOffset+dayOffset)%7],'shortWeekTitle[0]':weekShortTitle[(0+weekOffset+dayOffset)%7],'shortWeekTitle[1]':weekShortTitle[(1+weekOffset+dayOffset)%7],'shortWeekTitle[2]':weekShortTitle[(2+weekOffset+dayOffset)%7],'shortWeekTitle[3]':weekShortTitle[(3+weekOffset+dayOffset)%7],'shortWeekTitle[4]':weekShortTitle[(4+weekOffset+dayOffset)%7],'shortWeekTitle[5]':weekShortTitle[(5+weekOffset+dayOffset)%7],'shortWeekTitle[6]':weekShortTitle[(6+weekOffset+dayOffset)%7]});html=this.replaceWith(options.template.calMonth,{content:html,offset:'data-offset="'+offset+'"'});return html;},createDate:function(date){var self=this;var html="";var dateHtml="";var dates=this.getDateArrayByMonth(date);var dateSize=dates.length;var options=this.options;var weekHeader=self.options.weekHeader;var weekInterval=self.options.weekInterval;dates.forEach(function(row,index){dateHtml="";if(weekHeader){dateHtml+="<td class='ui-calendar-week-header'></td>";}
row.forEach(function(cal){if(cal){var dateMap=Calendar.dateFormat(cal,self.options.dateFormat);var singleDateHtml=self.replaceWith(options.template.day,{week:cal.getDay(),day:Calendar.dateFormat(cal,"dd"),className:self.getClass(cal,date),dateMap:'data-date-map="'+dateMap+'"'});}else{singleDateHtml='<td><div class="date caldate caldisabled"></div></td>';}
dateHtml+=singleDateHtml;});html+=self.replaceWith(options.template.weekWrap,{week:dateHtml});if(weekInterval){if(dateSize-1===index){}else{html+='<tr><td class="ui-calendar-week-interval" colspan="8"></td></tr>'}}});return html;},getClass:function(cal,date){var year=cal.getFullYear();var month=cal.getMonth();var calDate=Calendar.dateToDay(cal);var className="date";var thisDate=Calendar.dateToDay(this.date);var dayNext=this.options.dayNext;var dayPrev=this.options.dayPrev;var dayDisableNext=this.options.dayDisableNext;var cascadingOffset=this.options.cascadingOffset;var cascadingMin=this.options.cascadingMin;var cascading=this.options.cascading;if((year==date.getFullYear())&&(month==date.getMonth())){className+=" caldate";}else if(this.options.division){className+=" caldate notThisMonth";}else{if(this.wrap.is(".ui-calendar-mini")){className+=" nodate notThisMonth";}else{className+=" caldate notThisMonth";}}
var dayBetween=Calendar.getDaysBetween(thisDate,calDate);if(calDate>thisDate&&dayNext!=-1&&dayBetween>dayNext){className+=" nodate";}
if(calDate>=thisDate&&dayBetween<dayDisableNext){className+=" nodate";}
if(cascading&&this.cascadingIndex===0){var minDate=Calendar.dateOffset(calDate,cascadingMin);var lastDate=Calendar.dateOffset(thisDate,dayNext);if(minDate>lastDate&&dayNext!=-1){className+=" nodate";}}
if((calDate<thisDate)&&(dayPrev!=-1)&&(dayBetween>dayPrev)){className+=" nodate";}
if(Calendar.isSameDay(thisDate,cal)){className+=" today";if(!this.options.isTodayClick){className+=" caldisabled"}}
return className;},replaceWith:function(str,obj){for(var i in obj){str=str.replace("{{"+i+"}}",obj[i]);}
return str;},getDate:function(){return this.now.getDate();},getMonth:function(){return this.now.getMonth();},getFullYear:function(){return this.now.getFullYear();},getDay:function(){return this.now.getDay();},getWeekTitle:function(i){return this.options.weekTitle[i];},getWeekShortTitle:function(i){return this.options.weekShortTitle[i];},getDateArrayByMonth:function(date){var division=this.options.division;var dateArray=[];var year=date.getFullYear();var month=date.getMonth();var firstDate=new Date(year,month,1);var nextMonthFirstDate=new Date(year,month+1,1);var firstDateDay=firstDate.getDay();var index=-firstDateDay+this.options.weekOffset;index=index>0?index-7:index;index+=this.options.dayOffset;var row=0;var col=0;var space;var spaceStart=false;if(division){var lastDayIndex=firstDateDay+Calendar.getDaysInMonth(month,year);if(lastDayIndex>35){index+=22;}else{index+=15;}
if(lastDayIndex==35){space=0}else{space=7;}
for(row=0;row<6;row++){dateArray[row]=[];for(col=0;col<7;col++){var newDate=new Date(firstDate.getFullYear(),firstDate.getMonth(),index);if(space&&(spaceStart||(+nextMonthFirstDate==+newDate))){space--;dateArray[row][col]=null;}else{index++;dateArray[row][col]=newDate;}}}}else{for(row=0;row<6;row++){dateArray[row]=[];for(col=0;col<7;col++){index++;dateArray[row][col]=new Date(firstDate.getFullYear(),firstDate.getMonth(),index);}}}
return dateArray;},getSelect:function(){var cascading=this.options.cascading;if(cascading){return[this.cascadingSelected.start,this.cascadingSelected.end];}else{var selected=[];for(var s in this.selected){selected.push(s)}
return selected;}},getDayOfWeek:function(date,noFestival){date=date||this.now;if(date){if(Calendar.isSameDay(today,date)){return this.options.todayTitle;}
if(!noFestival){var nowStr=Calendar.dateFormat(date,this.options.dateFormat);if(nowStr){var festival=this.options.festival[nowStr];if(festival){if(festival.name){return festival.name;}}}}
var dayOfTheWeek=date.getDay();return this.options.weekTitle[dayOfTheWeek];}},loading:function(){var $loading=this.wrap.find(".month-loading");$loading.show();},loaded:function(){var $loading=this.wrap.find(".month-loading");$loading.hide();}};var calControl='<span class="month-prev" title="上一月">‹</span><span class="month-next" title="下一月">›</span>';var calWrap='<div class="calwrap clearfix">{{content}}</div>';var calMonth='<div class="calmonth" {{offset}}>{{content}}</div>';var calTitle='<div class="caltitle"><span class="mtitle">{{month}}</span></div>';var calTable='<table class="caltable">'+'    <thead>'+'        <tr>'+'            {{weekHeader}}'+'            <th class="{{englishWeekTitle[0]}}">{{shortWeekTitle[0]}}</th>'+'            <th class="{{englishWeekTitle[1]}}">{{shortWeekTitle[1]}}</th>'+'            <th class="{{englishWeekTitle[2]}}">{{shortWeekTitle[2]}}</th>'+'            <th class="{{englishWeekTitle[3]}}">{{shortWeekTitle[3]}}</th>'+'            <th class="{{englishWeekTitle[4]}}">{{shortWeekTitle[4]}}</th>'+'            <th class="{{englishWeekTitle[5]}}">{{shortWeekTitle[5]}}</th>'+'            <th class="{{englishWeekTitle[6]}}">{{shortWeekTitle[6]}}</th>'+'        </tr>'+'    </thead>'+'    <tbody>'+'        {{date}}'+'    </tbody>'+'    </table>';var calBody=''+'<div class="calbox">'+
calTable+'    <div class="month-loading"></div>'+'</div>';var weekWrap='<tr>{{week}}</tr>';var smallTemplate={wrap:'<div class="ui-calendar ui-calendar-mini" {{bimonthly}} {{float}}></div>',calControl:calControl,calWrap:calWrap,calMonth:calMonth,calTitle:calTitle,calBody:calBody,weekWrap:weekWrap,day:''+'<td data-week="{{week}}" {{dateMap}}>'+'    <div class="{{className}}">{{day}}</div>'+'</td>'};var bigTemplate={wrap:'<div class="ui-calendar ui-calendar-big" {{bimonthly}} {{float}}></div>',calControl:calControl,calWrap:calWrap,calMonth:calMonth,calTitle:calTitle,calBody:calBody,weekWrap:weekWrap,day:''+'<td data-week="{{week}}" {{dateMap}}>'+'    <div class="{{className}}">'+'        <div class="calday">{{day}}</div>'+'        <div class="calinfo"></div>'+'        <div class="calprice"></div>'+'        <div class="calactive"></div>'+'        <div class="calselected"></div>'+'    </div>'+'</td>'};var birthdayTemplate={wrap:'<div class="ui-calendar ui-calendar-mini ui-calendar-birthday" {{bimonthly}} {{float}}></div>',calControl:calControl,calWrap:calWrap,calMonth:calMonth,calTitle:calTitle,calBody:''+'<div class="calbox">'+
calTable+'<div class="cal-pane">'+'<span class="cal-time-text">时间</span>'+'<span class="cal-time-input">'+'<span class="cal-hour">00</span><span class="cal-time-to">:</span><span class="cal-minute">00</span>'+'</span>'+'<span class="btn btn-xs cal-birthday-clear">清空</span>'+'<span class="btn btn-xs cal-birthday-ok">确定</span>'+'</div>'+'<div class="month-loading"></div>'+'</div>',weekWrap:weekWrap,day:''+'<td data-week="{{week}}" {{dateMap}}>'+'    <div class="{{className}}">{{day}}</div>'+'</td>'};lv.calendar=Factory;window.lv=lv;nova.calendar=Factory;window.nova=nova;for(var c in Calendar){if(typeof Calendar[c]==="function"){Factory[c]=Calendar[c]}}})(window,jQuery,window.lv||{},window.nova||{});
;/*
 * dialog.js
 * 2016-11-14
 * Sheng Jiang
 * 1.0.0.0
 */
(function(window,$,nova){"use strict";if(nova.dialog){return false;}
var $document=$(document);var $body=$("body");var count=0;var timeStamp=+(new Date());var template=''+'<div class="nova-dialog">'+'    <div class="nova-dialog-close"><i></i></div>'+'    <div class="nova-dialog-header"></div>'+'    <div class="nova-dialog-body"></div>'+'    <div class="nova-dialog-footer"></div>'+'</div>';function Factory(options){options=$.extend({},Factory.defaults,options);var dialogId=timeStamp+count;count++;var dialog=new Dialog(options,dialogId);dialog.id=dialogId;Dialog.list[dialogId]=dialog;return dialog;}
Factory.defaults={template:template,cloneEvent:true,showClose:true,buttons:null,fixed:true,masked:true,draggable:false,topFixed:false,topOffset:60,initHeight:"300px",initCallback:null,beforeClosingCallback:null,okCallback:null,cancelCallback:null,okText:"确定",cancelText:"取消",okClassName:"btn-orange",cancelClassName:"",content:"",contentClone:true,title:"消息提醒",time:null,width:"",height:"",wrapClass:"",maskClass:"nova-overlay",zIndex:1};function Dialog(options,dialogId){this.init(options,dialogId);}
Dialog.list={};$(window).on("resize",function(){for(var id in Dialog.list){var dialog=Dialog.list[id];dialog.resize();}});Dialog.prototype={version:"1.0.0.0",construction:Dialog,init:function(options,dialogId){this.options=options;this.defaults=Factory.defaults;var self=this;self.setButton(options);var template=this.options.template;self.wrap=$(template);self.wrap.attr("data-id",dialogId);var wrap=self.wrap;wrap.addClass(options.wrapClass);self.buttons();self.size(options.width,options.height);self.title(options.title);self.content(options.content);if(options.zIndex===null){options.zIndex="auto";}
self.zIndex(options.zIndex);self.time(options.time);if(options.masked===true){setTimeout(function(){self.mask(options);},0);}
self.bindEvent(options);if(options.draggable===true){self.drag();}
self.showClose(options.showClose);self.wrap.hide();$body.append(self.wrap);setTimeout(function(){self.resize();self.wrap.show();if(typeof options.initCallback==="function"){options.initCallback.call(self);}},0);},loading:function(){this.content('<div class="nova-dialog-body-loading"><i></i><br>正在加载中...</div>');},showClose:function(showClose){if(showClose){this.wrap.find(".nova-dialog-close").show();}else{this.wrap.find(".nova-dialog-close").hide();}},drag:function(){var wrap=this.wrap;var dialogTop;var dialogLeft;var $header=wrap.find(".nova-dialog-header");var pageX;var pageY;$header.on("mousedown",function(e){wrap.addClass("nova-dialog-moving");pageX=e.pageX;pageY=e.pageY;$body.on("mousemove",mouseMoveHandler);});function mouseMoveHandler(e){var pageXNext=e.pageX;var pageYNext=e.pageY;var x=pageXNext-pageX;var y=pageYNext-pageY;pageX=pageXNext;pageY=pageYNext;dialogTop=parseInt(wrap.css("top"));dialogLeft=parseInt(wrap.css("left"));wrap.css({top:dialogTop+y,left:dialogLeft+x});}
$document.on("mouseup",function(e){$body.off("mousemove",mouseMoveHandler);wrap.removeClass("nova-dialog-moving");});},time:function(time){var self=this;var timer=this.timer;if(timer){clearTimeout(timer);}
if(time){this.timer=setTimeout(function(){self.close();},time);}},zIndex:function(index){this.wrap.css("zIndex",index);},setButton:function(){var options=this.options;if(options.buttons&&options.buttons.push){}else{options.buttons=[];}
if(options.okCallback){var okButton={className:options.okClassName,text:options.okText,callback:options.okCallback};options.buttons.push(okButton)}
if(options.cancelCallback){var cancelButton={className:options.cancelClassName,text:options.cancelText,callback:options.cancelCallback};options.buttons.push(cancelButton)}},buttons:function(){var buttons=this.options.buttons;var size=buttons.length;var className;var $footer=this.wrap.find(".nova-dialog-footer");if(size==0){$footer.hide();}
for(var i=0;i<size;i++){var button=buttons[i];var $button=$("<span class='btn'></span>");if($.isArray(button.className)){for(var j=0;j<button.className.length;j++){className+=button.className[j]+" ";}}else{if(button.className===undefined){className=""}else{className=button.className}}
$button.attr({"class":"btn "+className}).html(button.text);$footer.append($button);}},bindEvent:function(){var self=this;self.wrap.on("click",".nova-dialog-close",{self:self},self.closeDialogHandler);self.wrap.on("click",".nova-dialog-footer>*",{self:self},self.buttonHandler)},buttonHandler:function(e){var self=e.data.self;var $this=$(this);var index=$this.index();var button=self.options.buttons[index];var callback=button.callback;if(callback&&$.isFunction(callback)){var ret=callback.call(self);if(ret===false){}else{self.close();}}else{self.close();}},closeDialogHandler:function(e){var self=e.data.self;self.close();},close:function(force){var contentClone=this.options.contentClone;var beforeunload=this.options.beforeClosingCallback;if(!force&&beforeunload&&$.isFunction(beforeunload)){var ret=beforeunload.call(this);if(ret===false){return;}}
if(!contentClone){if(this._elemBack){this._elemBack();}}
this.wrap.remove();this.mask();delete Dialog.list[this.id];},title:function(title){var $header=this.wrap.find(".nova-dialog-header");if(title===null){$header.hide();this.wrap.addClass("nova-dialog-no-title");}else{$header.html(title);}},content:function($content){var self=this;if(this._elemBack){this._elemBack();}
var $body=this.wrap.find(".nova-dialog-body");var contentClone=this.options.contentClone;if(this.options.url){this.wrap.addClass("nova-dialog-custom");var $iframe=$('<iframe src="'+$content+'" frameborder="0"></iframe>');$body.html($iframe);var dialogHeight=this.wrap.height();var $header=this.wrap.find(".nova-dialog-header:visible");var $footer=this.wrap.find(".nova-dialog-footer:visible");var headerHeight=$header.outerHeight(true);var footerHeight=$footer.outerHeight(true);var bodyHeight=dialogHeight-(headerHeight?headerHeight:0)-(footerHeight?footerHeight:0);var initialHeight=this.options.initHeight;if(initialHeight){$body.height(parseInt(initialHeight))}else{$body.height(bodyHeight);}
return;}
if(typeof $content==="string"){$body.html($content);}else if($($content).get(0)&&$($content).get(0).nodeType===1){if(contentClone){var cloneEvent=this.options.cloneEvent;var contentCloned=$content.clone(cloneEvent);contentCloned.show();$body.html(contentCloned);}else{var content=$($content).get(0);var display=content.style.display;var prev=content.previousSibling;var next=content.nextSibling;var parent=content.parentNode;this._elemBack=function(){if(prev&&prev.parentNode){prev.parentNode.insertBefore(content,prev.nextSibling);}else if(next&&next.parentNode){next.parentNode.insertBefore(content,next);}else if(parent){parent.appendChild(content);}
content.style.display=display;self._elemBack=null;};$body.html($content);$content.show();}}},size:function(width,height){if(typeof width==="number"){width+="px";}
if(typeof height==="number"){height+="px";}
this.wrap.css({width:width,height:height});},resize:function(){var $window=$(window);var windowHeight=$window.height();var windowWidth=$window.width();var dialogWidth=this.wrap.width();var dialogHeight=this.wrap.height();var left=~~((windowWidth-dialogWidth)/2);if(this.options.topFixed){var dialogAutoTop=$window.scrollTop()+this.options.topOffset;this.wrap.css({position:"absolute",top:dialogAutoTop,left:left});return;}
if(windowHeight-dialogHeight>=0){this.offsets();}else{var dialogTop=$window.scrollTop()+10;this.wrap.css({position:"absolute",top:dialogTop,left:left})}},offsets:function(){var windowWidth=$(window).width();var windowHeight=$(window).height();var dialogWidth=this.wrap.width();var dialogHeight=this.wrap.height();var left=~~((windowWidth-dialogWidth)/2);var top=~~((windowHeight-dialogHeight)/2);this.wrap.css({position:"fixed",top:top,left:left})},mask:function(){var mask=this.options.masked;if(mask){this.wrap.attr("data-mask","mask");}
var $mask;$mask=$(".nova-overlay");if($mask.length==0){$mask=$('<div class="nova-overlay"></div>');$body.append($mask);}
$mask.css("zIndex",this.options.zIndex);var $dialogs=$(".nova-dialog[data-mask=mask]");$mask.attr("class","nova-overlay");if($dialogs.length==0){$mask.hide();}else{$mask.show();var $dialog=$dialogs.last();var dialogId=$dialog.attr("data-id");var dialog=Dialog.list[dialogId];$dialog.before($mask);var maskClass=dialog.options.maskClass;$mask.addClass(maskClass);$mask.css("zIndex",dialog.options.zIndex);}}};nova.dialog=Factory;window.nova=nova;nova.alert=function(content,callback){return Factory({fixed:true,masked:true,content:content,okCallback:true,beforeClosingCallback:callback});};nova.confirm=function(content,okCallback,cancel){return Factory({fixed:true,lock:true,content:content,okCallback:okCallback?okCallback:true,cancelCallback:cancel?cancel:true});};nova.msg=function(content,time){return Factory({showClose:false,title:null,fixed:true,masked:false,content:content,time:time?time:2000});};nova.loading=function(content,callback){var html='<div class="nova-dialog-body-loading"><i></i></div>';return Factory({showClose:false,title:null,content:content?content:html,beforeClosingCallback:callback})};for(var c in Dialog){if(Dialog.hasOwnProperty(c)){if(typeof Dialog[c]==="function"){Factory[c]=Dialog[c]}}}})(window,jQuery,window.nova||{});
;/*
 * Validate.js
 * 2016-03-15
 * 2016-06-12
 * Sheng Jiang
 * 1.0.0.0
 */
(function(window,$,nova){"use strict";if(nova.validate){return false;}
var $document=$(document);var zipRegExp=/^\d{6}$/;var englishRegExp=/^[a-zA-Z\s]+$/;var chineseRegExp=/^[\u4e00-\u9fa5]+$/;var chineseAndEnglishRegExp=/^[a-zA-Z\u4e00-\u9fa5\s]+$/;var emailRegExp=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;var phoneRegExp=/^1[3-9]\d{9}$/;function Factory(options){options=$.extend({},Factory.defaults,options);return new Validate(options);}
Factory.defaults={target:"body",triggerEvent:"change",rules:{},validateCallback:null,messages:{error:"格式错误",required:"必须填写。","chinese-and-english":"请输入中文或英文。",chinese:"请输入中文。",english:"请输入英文。",mobile:'暂不支持您输入的号码段，请联系驴妈妈客服<span class="c_f60">1010-6060</span>进行反馈',email:"电子邮箱格式不正确，请重新输入。",zip:"邮政编码只能为6位数字，请重新输入。",idcard:"请输入正确的身份证号码。"}};function Validate(options){this.init(options);}
Validate.prototype={version:"1.0.0.0",construction:Validate,destruction:function(){},init:function(options){this.options=options;this.defaults=Factory.defaults;this.$target=$(options.target);var expandMethods=options.expandMethods;for(var expandMethod in expandMethods){this.addMethod(expandMethod,expandMethods[expandMethod]);}
this.$firstError=null;this.bindEvent();},validateInput:function(ruleDetails,rule,$input){var inputValidate=true;var rules=this.options.rules;var messages=this.options.messages;var message=this.options.messages.error;var validateCallback=this.options.validateCallback;var val=$.trim($input.val());for(var ruleDetail in ruleDetails){var defaultMessage=messages[ruleDetail];if(defaultMessage){message=defaultMessage;}
var ruleMessage=rules[rule][ruleDetail+"-message"];if(ruleMessage){message=ruleMessage;}
var method=this.methods[ruleDetail];var complexMethod=this.complexMethods[ruleDetail];var result=true;if(method&&$.isFunction(method)){var parameter=rules[rule][ruleDetail];if(ruleDetail!=="required"&&val.length===0){}else{result=method.call(this,val,$input,parameter);}
if(validateCallback&&$.isFunction(validateCallback)){validateCallback.call(this,result,val,$input,message);}
if(result===false){inputValidate=false;break;}}
if(complexMethod&&$.isFunction(complexMethod)){var error=true;error=complexMethod.call(this,val,$input,parameter);if(validateCallback&&$.isFunction(validateCallback)){validateCallback.call(this,error==true,val,$input,error);}
if(error!==true){inputValidate=false;break;}}}
return inputValidate;},bindEvent:function(){var rules=this.options.rules;var self=this;var triggerEvent=this.options.triggerEvent;for(var rule in rules){(function(rule){self.$target.on(triggerEvent,rule,function(){var $input=$(this);var ruleDetails=rules[rule];self.validateInput(ruleDetails,rule,$input);});})(rule)}},getValidate:function(){var rules=this.options.rules;this.$firstError=null;var isThatAllRight=true;for(var rule in rules){var $inputs=this.$target.find(rule);var ruleDetails=rules[rule];for(var index=0;index<$inputs.length;index++){var $input=$inputs.eq(index);var ret=this.validateInput(ruleDetails,rule,$input);if(!ret){isThatAllRight=false;}}
if(isThatAllRight===false&&!this.$firstError){this.$firstError=$input;}}
return isThatAllRight;},methods:{required:function(value,$element){return value.length>0;},maxlength:function(value,$element,parameter){return value.length<=parameter;},minlength:function(value,$element,parameter){return value.length>=parameter;},email:function(value,$element){return emailRegExp.test(value);},"idcard":function(value,$element){function calcChecksum(rid){var arr=rid.split('').reverse();function w(i){return Math.pow(2,i-1)%11;}
function s(){var sum=0;for(var j=0;j<17;j++){sum+=arr[j]*w(j+2);}
return sum;}
return(12-(s()%11))%11;}
function idCard18Test(idNumber){var idCard18Regular=/^\d{17}[0-9Xx]$/;var regularTestResult=idCard18Regular.test(idNumber);if(!regularTestResult){return false;}
var year;var month;var date;year=parseInt(idNumber.substr(6,4),10);month=parseInt(idNumber.substr(10,2),10);date=parseInt(idNumber.substr(12,2),10);var birthday=new Date(year,month-1,date);if(birthday.getFullYear()!==year||birthday.getMonth()!==(month-1)||birthday.getDate()!==date){return false;}
var rid=idNumber.substr(0,17);var code=idNumber.substr(17,1);var calcCode=(calcChecksum(rid));if(parseInt(code,10)===calcCode||(code==="X"&&calcCode===10)){}else{return false;}
return true;}
function idCard15Test(idNumber){var idCard15Regular=/^\d{15}$/;var regularTestResult=idCard15Regular.test(idNumber);if(!regularTestResult){return false;}
var year;var month;var date;year=parseInt("19"+idNumber.substr(6,2),10);month=parseInt(idNumber.substr(8,2),10);date=parseInt(idNumber.substr(10,2),10);var birthday=new Date(year,month-1,date);if(birthday.getFullYear()!==year||birthday.getMonth()!==(month-1)||birthday.getDate()!==date){return false;}
if(idNumber==="111111111111111"){return false;}
return true;}
var idNumber=value.toUpperCase();var size=idNumber.length;if(size===18){return idCard18Test(idNumber);}
if(size===15){return idCard15Test(idNumber);}
return false;},"chinese-and-english":function(value,$element){return chineseAndEnglishRegExp.test(value);},chinese:function(value,$element){return chineseRegExp.test(value);},english:function(value,$element){return englishRegExp.test(value);},mobile:function(value,$element){return phoneRegExp.test(value);},zip:function(value,$element){return zipRegExp.test(value);}},complexMethods:{"pass-port-name":function(value,$element){if(/^([a-zA-Z])+\/+([a-zA-Z])+$/.test(value)){return true;}
if(!chineseAndEnglishRegExp.test(value)){return'姓名只能包含汉字、字母和空格，请重新输入';}
if(englishRegExp.test(value)){return'英文姓名请用“/”分割';}
return true;}},addMethod:function(name,method){this.complexMethods[name]=method;}};nova.validate=Factory;window.nova=nova;for(var c in Validate){if(typeof Validate[c]==="function"){Factory[c]=Validate[c]}}})(window,jQuery,window.nova||{});